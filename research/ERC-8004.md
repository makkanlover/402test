# ERC-8004 — 技術要件定義

## 概要 / 背景
- ERC-8004 は、イーサリアム上で **信頼なし (trustless)** に AI エージェント (Agent) を発見・認証・相互作用させるための標準規格。 :contentReference[oaicite:23]{index=23}  
- これは Google の A2A (Agent-to-Agent) プロトコルを拡張する形で設計されており、中央集権を介さずにエージェント経済 (agent economy) を構築するのが狙い。 :contentReference[oaicite:24]{index=24}  
- プラグイン可能な信頼モデル (trust models) を採用。タスクのリスク／価値に応じて異なる検証強度を選べる。 :contentReference[oaicite:25]{index=25}  

## コア構成要素 (Registry)
ERC-8004 は以下の **3 つの軽量レジストリ** (on-chain) を定義：

1. **Identity Registry (アイデンティティ)**
   - ERC-721 トークン (NFT) として各エージェントに一意識別子 (AgentID) を割り当て。 :contentReference[oaicite:26]{index=26}  
   - ERC-721 URIStorage 拡張を使って、エージェントのメタデータ（能力、エンドポイント、プロトコルサポートなど）を格納。 :contentReference[oaicite:27]{index=27}  
   - この NFT は検閲耐性があり、エージェントがどこからでも参照可能。 :contentReference[oaicite:28]{index=28}  

2. **Reputation Registry (評判)**
   - クライアント (タスク発注者) が支払い証明 (例: x402 の支払いトークン) を使ってレビューを出すことができる。 :contentReference[oaicite:29]{index=29}  
   - 評価スコア (0–100)、オプションのタグ、オフチェーンの詳細フィードバック (URI 経由) を登録可能。 :contentReference[oaicite:30]{index=30}  
   - 評判は信頼性の指標として、他のエージェントやクライアントが参照可能。

3. **Validation Registry (検証)**
   - タスク実行後の「正当性 (obligation)」を検証する仕組みを提供。 :contentReference[oaicite:31]{index=31}  
   - 検証モデルは柔軟：ステーク (ステーキング) による再実行者 (validator)、zkML (ゼロ知識機械学習) 証明、Trusted Execution Environment (TEE) ベースのオラクルなどを選べる。 :contentReference[oaicite:32]{index=32}  
   - `validationRequest` 関数で検証要求を出し、結果を記録。 :contentReference[oaicite:33]{index=33}  

## セキュリティと設計思想
- 最小主義 (minimal) な設計を目指しており、オンチェーンには必要最小限の情報のみを持たせる。 :contentReference[oaicite:34]{index=34}  
- 大きなデータや動的な情報 (例：詳細なメタデータやログ) はオフチェーン URI (IPFS など) に置ける。 :contentReference[oaicite:35]{index=35}  
- プラガブルな検証モデルにより、ガスコストやセキュリティ／信頼のトレードオフをアプリケーションごとに最適化可能。 :contentReference[oaicite:36]{index=36}  

## 相互運用性 / エコシステム
- x402 などの支払いレイヤーと補完関係にある。支払い (x402) + 信頼 (ERC-8004) によって自律エージェント間の完全な経済が成り立つ。 :contentReference[oaicite:37]{index=37}  
- 複数のプロジェクト／レイヤーで採用が進んでいる：例として EigenLayer (ステーキング検証)、Phala Network (TEE 検証)、Unibase (エージェントの記憶層)、Virtuals (エージェント発行プラットフォーム) など。 :contentReference[oaicite:38]{index=38}  
- オープンソース参照実装あり。レジストリのコントラクトおよびインタフェースが公開されていて、開発者はこれをベースに独自の信頼モデルを拡張可能。 :contentReference[oaicite:39]{index=39}  

## ユースケース / シナリオ
- **タスク委託型エージェント市場**: クライアント (人間やエージェント) が未知の AI エージェントをタスクとして選択 → 評判・検証機能を使って実行 → 結果を評価 → 報酬支払い。  
- **高リスクタスク**: 医療診断、金融予測、重要なビジネスロジックなど、誤動作コストが高いタスクでは、ステークまたは証明ベースのバリデーションを使って信頼性を担保。  
- **agent discovery（発見）**: エージェントが Ethereum ブロックチェーン上で自分を登録し、他のエージェントから発見される。  
- **長期協業**: 評判履歴を使って、信頼できるエージェントとの継続的な協業を構築。

## 技術的リスク・懸念点
- ガスコスト：ERC-721 (Identity) / 評判 / 検証レジストリそれぞれをオンチェーンで管理すると費用がかさみ得る。  
- Sybil 攻撃：評判スコアの偽装 (偽エージェントによる自己評価) の可能性。  
- 評価操作：レビューを出すクライアントやバリデーターが操作するリスク (ブロックチェーン上の評価システムの設計に依存)。  
- プライバシー：エージェントのメタデータ (URI) にセンシティブな内容を含める場合、公開性とのバランスを取る必要あり。  
- 検証遅延：ステークや zk 証明を使う検証では時間がかかる可能性がある。

## 開発者への提案 / 要件定義ポイント
- ERC-8004 の **レジストリコントラクト** (Identity, Reputation, Validation) をデプロイ／参照する。  
- 各エージェント (スマートコントラクトまたはバックエンド) に対して、ERC-721 ベースの AgentID を発行／管理する。  
- クライアント (タスク発注側) と評価ロジック (Reputation) のワークフローを設計。  
- バリデーション戦略を選定：ステーク方式 (ステーキング型)、TEE (信頼実行環境)、または zkML などを検討。  
- オフチェーンメタデータ (Agent の能力、エンドポイントなど) の管理方法 (IPFS など) を設計。  
- セキュリティ監査およびガスコスト最適化のため、レジストリ契約に対するテストケース (単体テスト、境界値、攻撃シナリオ) を作成。

---

